name: Release CLI demo
on:
  workflow_run:
    workflows:
      - "Build CLI Demo"
    types:
      - "completed"
  workflow_dispatch:

jobs:
  release:
    runs-on: ubuntu-latest

    defaults:
      run:
        shell: bash
        working-directory: ./

    steps:
      - name: Download all workflow run artifacts
        id: download-artifact
        uses: dawidd6/action-download-artifact@v2
        with:
          workflow: cli-demo_build.yaml
      - name: Bump version and push tag
        id: tag_version
        uses: mathieudutour/github-tag-action@v6.1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
      - name: Create a GitHub release
        uses: ncipollo/release-action@v1
        with:
          tag: ${{ steps.tag_version.outputs.new_tag }}
          name: Release ${{ steps.tag_version.outputs.new_tag }}
          body: ${{ steps.tag_version.outputs.changelog }}
          artifacts: "./upload-binary/cli-demo"
